{"version":3,"sources":["jslibs/MyFilter.js","jslibs/MyPitchShifter.js","jslibs/MyPitchShifterWorkletNode.js","jslibs/PlayButton.js","jslibs/SpeedPitchControls.js","jslibs/TrackGainSlider.js","jslibs/TrackGainSliderList.js","App.js","AppNoWorklet.js","serviceWorkerRegistration.js","reportWebVitals.js","index.js"],"names":["noop","MyFilter","pipe","callback","sourceSound","historyBufferSize","_sourcePosition","outputBufferPosition","_position","source","i","length","this","push","outSamples","numFramesReq","numFramesExtracted","set","slice","splice","numFrames","samples","Float32Array","extractSource","inputBuffer","putSamples","SimpleFilter","MyPitchShifter","context","numOfInputFrames","bufferSize","record","bypass","console","log","recordedSamples","lastPlayingAt","_soundtouch","SoundTouch","_filter","_onEnd","_onUpdate","_updateInterval","_node","createScriptProcessor","onaudioprocess","bind","_totalInputFrames","_recordedBuffer","_nVirtualOutputFrames","_playingAt","inSamples","sampleRate","nInputFrames","nframes","tempo","pitch","rate","createProcessedBuffer","func","val","name","disconnect","outputBuffer","createBuffer","left","getChannelData","right","e","passThrough","stop","nOutputFrames","process","playingAt","leftIn","rightIn","putSource","framesExtracted","extract","nc","numberOfChannels","channel","input","filename","blob","Blob","toWav","type","saveAs","sleep","msec","Promise","resolve","setTimeout","MyPitchShifterWorkletNode","workletName","options","constructor","recording","processorOptions","port","onmessage","messageProcessor","running","value","postMessage","command","args","a","data","createRecordedBuffer","status","audioBuffer","output","_recordBuffer","AudioWorkletNode","PlayButton","props","state","nextAction","m","messages","handler","prevProps","setState","icon","Tooltip","title","alert","IconButton","onClick","target","color","playButton","style","Component","SpeedPitchControls","playSpeed","playPitch","setSpeed","setPitch","className","speedTitle1","toFixed","speedTitle2","pitchTitle","TrackGainSlider","gain","id","trackName","undefined","min","max","onChange","TrackGainSliderList","inputAudio","gains","version","packageJSON","subversion","defaultLang","en","window","navigator","language","ja","tmp","OfflineAudioContext","isOfflineAudioContext","isAudioWorkletNode","webkitAudioWorkletNode","AudioContext","isAudioWorklet","audioWorklet","addModule","close","isAudioWorkletAvailable","App","audioCtx","mixedSource","masterGainNode","isPlaying","timeA","timeB","loop","loopDelay","playButtonNextAction","masterGain","useAudioWorklet","micOn","shifter","loadFiles","handlePlay","handleGainSlider","handleTimeSlider","playAB","switchLanguage","switchLang","worklet","fileReader","multiple","accept","clearFiles","clearButton","timeTitle","timeSliderPosition","duration","timeSlider","setA","setB","resetAB","playerTitle","stopButton","loopButton","exportButton","aria-label","playMixButton","bypassButton","masterGainTitle","trackGainTitle","href","url","rel","guide","credit","event","files","loadModule","reader","FileReader","onload","decodeAudioData","result","gainNode","error","err","onerror","readAsArrayBuffer","parseFloat","offline","suspend","resume","index","parseInt","speed","Math","pow","delay","exporter","channels","updateInterval","createBufferSource","buffer","addZeros","createGain","connect","node","destination","begin","currentTime","start","startRendering","onended","onUpdate","oncomplete","renderedBuffer","exportToFile","Date","now","playSource","onEnd","recordedBuffer","moduleName","workletOptions","ch","isLocalhost","Boolean","location","hostname","match","registerValidSW","swUrl","config","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onSuccess","catch","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","document","getElementById","URL","origin","addEventListener","fetch","headers","response","contentType","get","indexOf","ready","unregister","reload","checkValidServiceWorker","serviceWorkerRegistration"],"mappings":"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","file":"static/js/main.5f5b771b.chunk.js","sourcesContent":["/*\n   Written by goto at kmgoto.jp (Mar. 2021)\n   Copyright of my code is not claimed.\n\n   Based on soundtouchjs/src/PitchShifter.js, SimpleFilter.js\n\n   Modified for use as intermediate ScriptProcessorNode.\n   Note: Output does not work for OfflineAudioContext.\n\n   1) PitchShifter ---> MyPitchShifter (minimum code)\n                     includes ScriptProcessorNode\n\n   2) MyFilter extends SimpleFilter\n\n   Pitch modification and slow down/speed up work.\n   Slow down only for real-time playback.\n   fast playback is impossible by nature.\n\n */\n\nimport { SimpleFilter } from 'soundtouchjs'; \n\nconst noop = function () {return;}\n\nexport default class MyFilter extends SimpleFilter {\n  constructor(pipe, callback = noop){\n    super(null, pipe, callback); // sourceSound, callback are not used\n    this.callback = callback;\n    this.sourceSound = [];\n    this.historyBufferSize = 22050;\n    this._sourcePosition = 0;\n    this.outputBufferPosition = 0;\n    this._position = 0;\n  }\n\n/* new method to put samples from e.inputBuffer in onaudioprocess */\n  putSource(source){ \n    //console.log('putSource');\n    for (let i = 0; i < source.length; i++) \n       this.sourceSound.push(source[i]);\n  } // LR interleaved\n\n/* new method replaces getWebAudioNode.extract() */\n  extractSource(outSamples, numFramesReq, frameOffset = 0){\n    // console.log('extractSource');\n   \n    let numFramesExtracted = 0;\n    if (this.sourceSound.length < numFramesReq*2) {\n      numFramesExtracted = 0;\n    } else { \n      outSamples.set(this.sourceSound.slice(0,numFramesReq*2));\n      this.sourceSound.splice(0,numFramesReq*2);\n      numFramesExtracted = numFramesReq;\n    }\n    return numFramesExtracted;\n  }\n\n/* Override */\n  fillInputBuffer(numFrames = 0){// samples are LRLR \n    const samples = new Float32Array(numFrames * 2);\n    const numFramesExtracted = this.extractSource(samples,numFrames);\n    if (numFramesExtracted > 0)\n      this.inputBuffer.putSamples(samples,0,numFramesExtracted);\n  } \n\n/* inherited (called when input is end. Not used)\n  onEnd() { this.callback(); }\n*/\n\n\n};\n","/*\n   Written by goto at kmgoto.jp (Mar. 2021)\n   Copyright of my code is not claimed.\n\n   Based on soundtouchjs/src/PitchShifter.js, SimpleFilter.js\n\n   Modified for use as intermediate ScriptProcessorNode.\n   Note: Output does not work for OfflineAudioContext.\n\n   1) PitchShifter ---> MyPitchShifter (minimum code)\n                     includes ScriptProcessorNode\n\n   2) MyFilter extends SimpleFilter\n\n   Pitch modification and slow down/speed up work.\n   Slow down only for real-time playback.\n   fast playback is impossible by nature.\n\n */\n\nimport * as SoundTouch from 'soundtouchjs';\nimport MyFilter from './MyFilter';\nimport {saveAs} from 'file-saver';\nimport * as toWav from 'audiobuffer-to-wav';\n\nconst noop = function() {return;}\n\nexport default class MyPitchShifter {\n  constructor(context, numOfInputFrames, bufferSize, \n      record = false, bypass = false){\n    console.log('new MyPitchShifter instance');\n    this.context = context;\n    this.bufferSize = bufferSize;\n    this.record = record;\n    this.bypass = bypass;\n    this.recordedSamples = [[],[]];\n    this.lastPlayingAt = 0;\n\n    this._soundtouch = new SoundTouch.SoundTouch();\n    this._filter = new MyFilter(this._soundtouch, noop); \n    this._onEnd = noop;\n    this._onUpdate = noop;\n    this._updateInterval = 0.5;\n\n    this._node = context.createScriptProcessor(bufferSize,2,2);\n    this._node.onaudioprocess = this.onaudioprocess.bind(this);\n    this._totalInputFrames = numOfInputFrames;\n    this._recordedBuffer = null;\n    this._nVirtualOutputFrames = 0;\n    this._playingAt = 0;\n\n    this.outSamples = new Float32Array(bufferSize*2);\n    this.inSamples  = new Float32Array(bufferSize*2);\n    this.sampleRate = context.sampleRate; \n    this.nInputFrames = 0;\n\n   // this.process = this.process.bind(this);\n\n  }\n\n  set totalInputFrames(nframes){ this._totalInputFrames = nframes;}\n  get totalInputFrames(){ return this._totalInputFrames;}\n\n  get totalVirtualOutputFrames(){ return this._nVirtualOutputFrames;}\n\n  get playingAt(){\n    return this._playingAt;\n  }\n\n  get node(){ return this._node; }\n  set tempo(tempo){ this._soundtouch.tempo = tempo; }\n  get tempo(){ return this._soundtouch.tempo; }\n  set pitch(pitch){ this._soundtouch.pitch = pitch; }\n  get rate(){ return this._soundtouch.rate; }\n\n  get recordedBuffer(){ \n    if (this._recordedBuffer === null) this.createProcessedBuffer();\n    return this._recordedBuffer; \n  }\n\n  set onEnd(func){ this._onEnd = func; }\n  set onUpdate(func){ this._onUpdate = func; }\n  set updateInterval(val){ this._updateInterval = val;}\n  get updateInterval(){ return this._updateInterval;}\n\n  stop(){ \n    if (this._node.onaudioprocess) {\n      console.log(this.name, 'shifter stop');\n      this._node.onaudioprocess = null; \n      this._node.disconnect();\n      if (this._recordedBuffer === null) this.createProcessedBuffer();\n      this._onEnd(this._recordedBuffer);\n    }\n  }\n\n  createProcessedBuffer(){\n\n    if (!this.record) return;\n\n    const outputBuffer = this.context.createBuffer(\n      this.recordedSamples.length, // channels\n      this.recordedSamples[0].length, // sample length\n      this.sampleRate\n    );\n\n    const left = outputBuffer.getChannelData(0);\n    const right = outputBuffer.getChannelData(1);\n    left.set(this.recordedSamples[0]);\n    right.set(this.recordedSamples[1]);\n    // Typedarray.set(array[, offset])\n\n    this._recordedBuffer = outputBuffer;\n\n  } // end createProcessedBuffer()\n\n  onaudioprocess(e){\n    // console.log('onaudioprocess()');\n\n    if (this.bypass) { // pass through for test\n      if (this._nVirtualOutputFrames <= this._totalInputFrames){\n        this.passThrough(e.inputBuffer,e.outputBuffer); // through for test\n        this._nVirtualOutputFrames += e.outputBuffer.length;\n      } else this.stop();\n    } else {\n      if (this._nVirtualOutputFrames <= this._totalInputFrames){\n        const nOutputFrames = this.process(e.inputBuffer,e.outputBuffer);\n        this._nVirtualOutputFrames += nOutputFrames*this._soundtouch.tempo;\n      } else this.stop();\n    }\n\n   this._playingAt = this._nVirtualOutputFrames/this.sampleRate;\n\n   if (this.playingAt - this.lastPlayingAt >= this._updateInterval) {\n      this._onUpdate(this._playingAt);\n      this.lastPlayingAt = this._playingAt;\n   }\n\n   this.nInputFrames += e.inputBuffer.length; \n\n    return true;\n  }\n\n  process(inputBuffer,outputBuffer) { // using soundtouchjs \n    // console.log('MyPitchShifter process');\n    // input part\n    const leftIn = inputBuffer.getChannelData(0);\n    const rightIn = inputBuffer.getChannelData(1);\n    const inSamples = this.inSamples; // LR Interleave\n    const left = outputBuffer.getChannelData(0);\n    const right = outputBuffer.getChannelData(1);\n\n    for (let i = 0; i < inputBuffer.length; i++) {\n        inSamples[2*i] = leftIn[i]; \n        inSamples[2*i + 1] = rightIn[i]; \n    }\n    this._filter.putSource(inSamples);\n\n   // Output  node.onaudioprocess in function getWebAudioNode\n   // context, filter, sourcePositionCallback\n    const outSamples = this.outSamples;\n    const framesExtracted = this._filter.extract(outSamples, this.bufferSize);\n\n    for (let i=0; i < framesExtracted; i++) {\n      left[i]  = outSamples[i * 2]; \n      right[i] = outSamples[i * 2 + 1];\n      if (this.record) {\n        this.recordedSamples[0].push(left[i]);\n        this.recordedSamples[1].push(right[i]);\n      }\n    } \n\n    return framesExtracted;\n\n  } // End process\n\n // just copy inputBuffer to outputBuffer for test \n  passThrough(inputBuffer, outputBuffer){ \n    const nc = outputBuffer.numberOfChannels;\n    for (let channel=0; channel < nc; channel++){\n      const input = inputBuffer.getChannelData(channel);\n      const output = outputBuffer.getChannelData(channel);\n      output.set(inputBuffer.getChannelData(channel)); \n\n      if (this.record) \n        for (let i = 0; i < outputBuffer.length; i++) \n          this.recordedSamples[channel].push(input[i]);\n    }\n\n  } // End pathThrough()\n\n  exportToFile (filename){\n    if (!this.record) return;\n\n    console.log ('exportToFile: ', filename,\n      'length: ', this.recordedSamples[0].length);\n\n    if (this._recordedBuffer === null) this.createProcessedBuffer();\n\n    const blob = new Blob([toWav(this._recordedBuffer)], \n       {type: 'audio/vnd.wav'});\n    saveAs(blob, filename);\n\n    return;\n  } // end exportToFile()\n\n};\n","import {saveAs} from 'file-saver';\nimport * as toWav from 'audiobuffer-to-wav';\n\nconst noop = function() {return;}\nconst sleep = msec => new Promise(resolve => setTimeout(resolve, msec));\n\nclass MyPitchShifterWorkletNode extends AudioWorkletNode {\n  constructor(context,workletName, options){\n    super(context, workletName, options);\n\n    this.name = this.constructor.name;\n\n    // this.context = context; // already in super class\n    this.recording = options.processorOptions.recording;\n    this.sampleRate = options.processorOptions.sampleRate;\n    this.port.onmessage = this.messageProcessor.bind(this);\n    this._onUpdate = noop;\n    this._onEnd = noop;\n    this.recordedSamples = null;\n    this._recordedBuffer = null;\n   \n    this.running = true;\n\n  } // End constructor()\n\nget node(){ return this;} // for compatibility\n\n  set onEnd (func) { this._onEnd = func; }\n  set onUpdate (func) { this._onUpdate = func;}\n\n  set onUpdateInterval (value) { \n    this.port.postMessage({command: 'onUpdateInterval', args: [value]});}\n  set tempo(value){\n    this.port.postMessage({command: 'setTempo', args: [value]}); }\n  set pitch(value){\n    this.port.postMessage({command: 'setPitch', args: [value]}); }\n  get tempo(){\n    this.port.postMessage({command: 'getTempo', args: []}); \n    return this.tempo;\n  }\n  get pitch(){\n    this.port.postMessage({command: 'getPitch', args: []}); \n    return this.pitch;\n  }\n\n  get recordedBuffer(){\n    return this._recordedBuffer;\n  }\n\n  async stop(){\n    if (!this.running) return;\n\n    console.log(this.name, '.stop()');\n    await this.port.postMessage({command: 'stop', args: []});\n\n    this.disconnect();\n    // await this._recordedBuffer is filled\n\n    console.log(this.name,'sleep begin');\n    await sleep(3000); // sleep in msec\n    console.log(this.name,'sleep end');\n\n    this._onEnd(this._recordedBuffer);\n\n    this.running = false;\n  }\n\n  messageProcessor(e){\n    if(e.data.command){\n      const {command,args} = e.data;\n      // console.log(this.name, 'recvd', command);\n      switch(command) {\n        case 'End':\n          console.log(this.name, 'recvd', command);\n          this.recordedSamples = args[0]; \n          if (this.recordedSamples)\n             console.log (this.name, 'worklet stopped. recordedSamples');\n          else\n             console.log (this.name, 'worklet stopped. NO recordedSamples');\n          if (this.recording) this.createRecordedBuffer();\n\n          this.stop();\n        break;\n        case 'update' : \n          this._onUpdate(args[0]); // this.playingAt = args[0];\n        break;\n\n        default:\n      }\n      return;\n    }\n\n    if (e.data.status){\n      const value = e.data.args[1];\n      switch(e.data.args[0]){\n        case 'getTempo': this.tempo = value; break;\n        case 'getPitch': this.pitch = value; break;\n        default:\n      }\n      return;\n    }\n  } // End messgeProcessor()\n\n  exportToFile (filename, audioBuffer = null){\n\n    let output = null;\n    if (audioBuffer !== null) output = audioBuffer;\n    else if (this._recordedBuffer !== null)\n      output = this._recordBuffer; // use internal record\n    else {console.log ('output AudioBuffer is null'); return; }\n\n    const blob = new Blob([toWav(output)], {type: 'audio/vnd.wav'});\n    saveAs(blob, filename);\n\n    return;\n  } // end exportToFile()\n\n  createRecordedBuffer() {\n    if (!this.recordedSamples) {\n      console.log (this.name,'this.recordedBuffer empty') \n      return;\n    }\n\n    if (this.recordedSamples[0].length === 0) return null;\n\n    this._recordedBuffer = this.context.createBuffer(\n      this.recordedSamples.length, // channels\n      this.recordedSamples[0].length, // sample length\n      this.sampleRate\n    );\n\n    const left = this._recordedBuffer.getChannelData(0);\n    const right = this._recordedBuffer.getChannelData(1);\n    left.set(this.recordedSamples[0]);\n    right.set(this.recordedSamples[1]);\n\n    console.log(this.name,'createRecordedBuffer done');\n    return this._recordedBuffer;\n\n  } // End createRecordedBuffer\n\n};\n\nexport default MyPitchShifterWorkletNode;\n\n","import { Component } from 'react';\n\n// material-ui Icons, Tooltip\nimport { IconButton, Tooltip } from '@material-ui/core';\nimport PlayCircleOutlineIcon from '@material-ui/icons/PlayCircleOutline';\nimport PauseCircleOutlineOutlinedIcon\n        from '@material-ui/icons/PauseCircleOutlineOutlined';\n\nexport default class PlayButton extends Component {\n  constructor(props){\n    super();\n    this.state = {\n      nextAction: props.nextAction,\n      m : props.messages,\n    };\n    this.handler = props.handler;\n  }\n\ncomponentDidUpdate(prevProps) {\n  if (prevProps.nextAction !== this.props.nextAction) {\n    this.setState({nextAction: this.props.nextAction}); \n  }\n  if (prevProps.messages !== this.props.messages) {\n    this.setState({m: this.props.messages}); \n  }\n}\n\n// PlayButton \n  render(){\n    const {nextAction,m} = this.state;\n\n    let icon = null;\n    switch(nextAction){\n         case 'load files first!':\n           icon = \n             <Tooltip title={m.alert}>\n             <span><IconButton\n             onClick={() => this.handler({target: {name: 'startPause'}})} >\n             <PlayCircleOutlineIcon color='disabled'/>\n             </IconButton></span></Tooltip>;\n         break;\n         case 'Play': \n           icon = <Tooltip title={m.playButton}><IconButton  \n             onClick={() => this.handler({target: {name: 'startPause'}})} >\n             <PlayCircleOutlineIcon color='primary' />\n             </IconButton></Tooltip>;\n         break;\n         case 'Resume':\n           icon = <IconButton  \n             onClick={() => this.handler({target: {name: 'startPause'}})} >\n             <PlayCircleOutlineIcon style={{color: '#00aa00' }} />\n             </IconButton>;\n         break;\n         case 'Pause': \n           icon = <IconButton  \n             onClick={() => this.handler({target: {name: 'startPause'}})} >\n             <PauseCircleOutlineOutlinedIcon color='primary' />\n             </IconButton>;\n         break;\n         default:\n           icon = 'undefined';\n       }\n       return(<span>{icon}</span>);\n\n     } // end render\n\n};\n","import { Component } from 'react';\n\n// material-ui Icons\nimport { IconButton } from '@material-ui/core';\nimport AddIcon from '@material-ui/icons/Add';\nimport RemoveIcon from '@material-ui/icons/Remove';\n\nexport default class SpeedPitchControls extends Component {\n  constructor(props){\n    super();\n\n    this.state = {\n      playSpeed: props.playSpeed,\n      playPitch: props.playPitch,\n      m : props.messages,\n    };\n\n    this.setSpeed = props.setSpeed;\n    this.setPitch = props.setPitch;\n  }\n\ncomponentDidUpdate(prevProps) {\n  if (prevProps.playSpeed !== this.props.playSpeed) {\n    this.setState({playSpeed: this.props.playSpeed}); \n  }\n\n  if (prevProps.playPitch !== this.props.playPitch) {\n    this.setState({playPitch : this.props.playPitch}); \n  }\n\n  if (prevProps.messages !== this.props.messages) {\n    this.setState({m: this.props.messages}); \n  }\n}\n\n  render(){\n    const {m} = this.state;\n\n    return(<span>\n    <span>\n     <div className='text-divider'>{m.speedTitle1} \n       (<font color= 'green'>{(100*this.state.playSpeed).toFixed(0)}%)</font>\n       &nbsp; {m.speedTitle2}\n    </div>\n\n      <center>\n     &plusmn; 10% <IconButton \n         onClick={() => this.setSpeed({target: {name: 'sub10'}})} > \n     <RemoveIcon color='primary'/> </IconButton>\n     <IconButton\n         onClick={() => this.setSpeed({target: {name: 'add10'}})} > \n     <AddIcon color='primary'/> </IconButton>\n     &nbsp;&nbsp;&nbsp;\n     &plusmn; 1% <IconButton\n        onClick={() => this.setSpeed({target: {name: 'sub1'}})} > \n     <RemoveIcon color='primary'/> </IconButton>\n     <IconButton\n        onClick={() => this.setSpeed({target: {name: 'add1'}})} > \n     <AddIcon color='primary'/> </IconButton>\n</center>\n\n     <div className='text-divider'>{m.pitchTitle}&nbsp; \n (<font color='green'>{this.state.playPitch.toFixed(1)}</font>) (-12 -- +12)</div>\n<center>\n     b/# <IconButton\n        onClick={() => this.setPitch({target: {name: 'sub1'}})} > \n     <RemoveIcon color='primary'/> </IconButton>\n     <IconButton\n        onClick={() => this.setPitch({target: {name: 'add1'}})} > \n     <AddIcon color='primary'/> </IconButton>\n     &nbsp;&nbsp;&nbsp;\n     &plusmn; 10 cents <IconButton\n        onClick={() => this.setPitch({target: {name: 'sub10c'}})} > \n     <RemoveIcon color='primary'/> </IconButton>\n     <IconButton\n        onClick={() => this.setPitch({target: {name: 'add10c'}})} > \n     <AddIcon color='primary'/> </IconButton>\n      </center></span>\n\n      </span>); \n\n\n  } // end render\n\n};\n","import { Component} from 'react';\nimport '../App.css';\n\nexport default class TrackGainSlider extends Component {\n  constructor(props){\n   super();\n   this.state = {\n     gain: props.gain,\n   }\n   this.id = props.id;\n   this.trackName = props.trackName;\n   this.handler = props.handler;\n  } \n\n componentDidUpdate(prevProps) {\n   if (prevProps.gain !== this.props.gain) {\n     this.setState({gain: this.props.gain});\n   }\n }\n\n  render(){\n   if (this.state.gain === undefined || !this.trackName === undefined) return null;\n\n   return (<div className='slider'>\n    {this.trackName} ({this.state.gain})<br />\n     0 <input type='range' id={this.id} name='gainSlider'\n        min='0' max='100' value={this.state.gain}\n        onChange={this.handler} /> 100\n   </div>);\n  } // end render\n\n}; // End class TrackGainSlider\n","import { Component } from 'react';\nimport TrackGainSlider from './TrackGainSlider';\n\nexport default class TrackGainSliderList extends Component {\n  constructor(props){\n    super();\n    this.inputAudio = props.inputAudio;\n    this.handler = props.handler;\n    this.state = {\n     gains: props.gains,\n    };\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.inputAudio !== this.props.inputAudio){\n      this.setState({inputAudio: this.props.inputAudio});\n    }\n\n    if (prevProps.gains !== this.props.gains) {\n      this.setState({gains: this.props.gains});\n    }\n  }\n\n  render(){\n    if (this.inputAudio.length > 9) return null;\n    // max 8 tracks + record\n\n    // ugly but to avoid dynamic rendering\n    return (<div><center>\n     {this.inputAudio[0] ? <TrackGainSlider id={0} \n        trackName={this.inputAudio[0].name} \n        gain={this.state.gains[0]} handler={this.handler} /> : null}\n     {this.inputAudio[1] ? <TrackGainSlider id={1} \n        trackName={this.inputAudio[1].name} \n        gain={this.state.gains[1]} handler={this.handler} /> : null}\n     {this.inputAudio[2] ? <TrackGainSlider id={2} \n        trackName={this.inputAudio[2].name} \n        gain={this.state.gains[2]} handler={this.handler} /> : null}\n     {this.inputAudio[3] ? <TrackGainSlider id={3} \n        trackName={this.inputAudio[3].name} \n        gain={this.state.gains[3]} handler={this.handler} /> : null}\n     {this.inputAudio[4] ? <TrackGainSlider id={4} \n        trackName={this.inputAudio[4].name} \n        gain={this.state.gains[4]} handler={this.handler} /> : null}\n     {this.inputAudio[5] ? <TrackGainSlider id={5} \n        trackName={this.inputAudio[5].name} \n        gain={this.state.gains[5]} handler={this.handler} /> : null}\n     {this.inputAudio[6] ? <TrackGainSlider id={6} \n        trackName={this.inputAudio[6].name} \n        gain={this.state.gains[6]} handler={this.handler} /> : null}\n     {this.inputAudio[7] ? <TrackGainSlider id={7} \n        trackName={this.inputAudio[7].name} \n        gain={this.state.gains[7]} handler={this.handler} /> : null}\n     {this.inputAudio[8] ? <TrackGainSlider id={8} \n        trackName={this.inputAudio[8].name} \n        gain={this.state.gains[8]} handler={this.handler} /> : null}\n     </center></div>);\n\n  } // end render\n\n}; // End class TrackGainSliders\n","/*\n   Written by goto at kmgoto.jp (Mar. 2021)\n   Copyright of my code is not claimed.\n\n   Based on soundtouchjs/src/PitchShifter.js, SimpleFilter.js\n\n   Modified for use as intermediate ScriptProcessorNode.\n   Note: Output does not work for OfflineAudioContext.\n\n   1) PitchShifter ---> MyPitchShifter (minimum code)\n                     includes ScriptProcessorNode\n       or --> MyPitchShifternode (AudioWorkletNode)\n\n   2) MyFilter extends SimpleFilter\n\n   Pitch modification and slow down/speed up work.\n   Slow down only for real-time playback.\n   Fast real-time playback is impossible by nature.\n\n   3) AudioWorklet is in public/worklet/ \n      (public is the document root.)\n\n */\n\nimport { Component }  from 'react';\nimport './App.css';\nimport MyPitchShifter from './jslibs/MyPitchShifter'; // soundtouchJS\nimport MyPitchShifterWorkletNode from './jslibs/MyPitchShifterWorkletNode';\n// UI Components\nimport PlayButton from './jslibs/PlayButton';\nimport SpeedPitchControls from './jslibs/SpeedPitchControls';\nimport TrackGainSliderList from './jslibs/TrackGainSliderList';\n\nimport packageJSON from '../package.json';\nimport messages from './messages.json'; // English/Japanese messages\n\n// material-ui Icons, Tooltip\nimport { IconButton, Tooltip } from '@material-ui/core';\nimport StopOutlinedIcon from '@material-ui/icons/StopOutlined';\nimport LoopOutlinedIcon from '@material-ui/icons/LoopOutlined';\nimport GetAppIcon from '@material-ui/icons/GetApp';\nimport PlayCircleFilledWhiteIcon \n   from '@material-ui/icons/PlayCircleFilledWhite';\nimport NotInterestedIcon from '@material-ui/icons/NotInterested';\nimport MoodIcon from '@material-ui/icons/Mood';\nimport MicIcon from '@material-ui/icons/Mic';\n// import { AudioContext, OfflineAudioContext }  from 'standardized-audio-context';\n\n// get subversion string \nconst version = packageJSON.subversion;\n\n// alert(navigator.userAgent);\n\n// switch languages\nlet defaultLang = 'en';\nlet m = messages.en;\nconsole.log(window.navigator.language);\nif (window.navigator.language.slice(0,2) === 'ja') {\n  defaultLang = 'ja'; \n  m = messages.ja;\n}\n\n/*\nlet iOS = false;\nif(  navigator.userAgent.match(/iPhone/i) \n  || navigator.userAgent.match(/iPod/i)\n  || navigator.userAgent.match(/iPad/i)){\n  iOS = true;\n}\n*/\n\n// AudioWorklet check with OfflineAudioContext (from Google Labs example)\nlet tmp = false;\nif (OfflineAudioContext) {\n  tmp = true; \n  console.log('OfflineAudioContext available');\n } else tmp = false;\nconst isOfflineAudioContext = tmp;\n\nlet isAudioWorkletNode = false;\n\nlet AudioWorkletNode \n      = window.AudioWorkletNode || window.webkitAudioWorkletNode;\n\nif (AudioWorkletNode) {\n  isAudioWorkletNode = true;\n  console.log('AudioWorkletNode available');\n}\n\nlet context = new AudioContext(); \nlet isAudioWorklet = false;\nif (context.audioWorklet && \n    typeof context.audioWorklet.addModule === 'function'){\n  isAudioWorklet = true;\n  console.log('Audiocontext.AudioWorklet available');\n} \ncontext.close();\n\nconst isAudioWorkletAvailable = (isAudioWorkletNode & isAudioWorklet);\n\nclass App extends Component {\n\n  constructor (props) {\n    super();\n    this.audioCtx = null;\n    this.inputAudio = [];\n    this.mixedSource = null;\n    this.masterGainNode = null;\n \n    this.state = {\n      language: defaultLang,\n      isPlaying: false,\n      timeA: 0,\n      playingAt: 0,\n      timeB: 0, \n      loop: false,\n      loopDelay: 2,\n      playButtonNextAction: 'load files first!',\n      gains: [],\n      masterGain: 75,\n      playSpeed: 1.0,\n      playPitch: 0.0,\n      bypass: false,\n      useAudioWorklet: isAudioWorkletAvailable,\n      micOn: false,\n    };\n\n    this.shifter = null;\n\n    this.loadFiles = this.loadFiles.bind(this);\n    this.handlePlay = this.handlePlay.bind(this);\n    this.handleGainSlider = this.handleGainSlider.bind(this);\n    this.handleTimeSlider = this.handleTimeSlider.bind(this);\n    this.playAB = this.playAB.bind(this);\n    this.setSpeed = this.setSpeed.bind(this);\n    this.setPitch = this.setPitch.bind(this);\n    this.switchLanguage = this.switchLanguage.bind(this);\n  }   \n\n  componentWillUnmount () { // before closing app\n    if (this.audioCtx !== null) this.audioCtx.close();\n  }\n\n\n  render(){\n\n    return (\n     <div className=\"App\">\n     {m.title}\n     <br />\n     <center>\n     (language) &ensp;\n     <span className='tiny-button'>\n     <Tooltip title={m.switchLang}>\n      <button onClick = {this.switchLanguage}>\n      {this.state.language === 'ja' ? 'EN' : 'JP' }</button>\n     </Tooltip>\n     </span>\n     &ensp;(AudioWorklet)\n     <Tooltip title={m.worklet}>\n     <IconButton name='toggleWorklet'\n     onClick = {\n       () => {\n        if (isAudioWorkletNode)\n        this.setState({useAudioWorklet: !this.state.useAudioWorklet});}\n     } >\n     <MoodIcon color={this.state.useAudioWorklet? 'primary':'disabled'} />\n     </IconButton>\n     </Tooltip>\n     </center>\n     <hr />\n     <span className=\"selectFile\">\n     <Tooltip title={m.fileReader}>\n     <input type=\"file\" name=\"loadFiles\" multiple\n        accept=\"audio/*\" onChange={this.loadFiles} />\n     </Tooltip>\n     &emsp;<span className='tiny-button'>\n     <Tooltip title={m.clearFiles}>\n     <button name='clearFile' onClick = {() => {\n       this.setState({gains: [], \n       playButtonNextAction: 'load files first!'});\n       this.inputAudio = []; }} \n     >{m.clearButton}</button></Tooltip></span>\n     <br />\n     </span><br/>\n     <div className='text-divider'>{m.timeTitle}&nbsp;\n      ({m.timeSliderPosition}:&nbsp; \n       <font color='green'>{this.state.playingAt.toFixed(2)}</font>)\n     </div>\n     <center>\n     A: {this.state.timeA.toFixed(2)} -- B: {this.state.timeB.toFixed(2)}\n     &emsp; song length: {this.inputAudio[0] ? \n          this.inputAudio[0].data.duration.toFixed(2) : 0.00}\n     <br />\n     <div className='slider'>\n     <Tooltip title={m.timeSlider}>\n     <input type='range' name='timeSlider'\n       min='0' max= {this.inputAudio[0] ? \n              this.inputAudio[0].data.duration : 0}\n       value={this.state.playingAt}\n       onChange={this.handleTimeSlider}\n     />\n     </Tooltip>\n     </div>\n     <span className='tiny-button'>\n     <Tooltip title={m.setA}>\n     <button name='setA' \n        onClick={()=> this.setState({timeA: this.state.playingAt})}>\n        set A\n     </button>\n     </Tooltip>\n      &emsp;\n     <Tooltip title={m.setB}>\n     <button name='setB' \n        onClick={()=> this.setState({timeB: this.state.playingAt})}>\n        set B\n     </button>\n     </Tooltip>\n      &emsp;\n     <Tooltip title={m.resetAB}>\n     <button name='reset' \n        onClick={()=> this.setState({timeA: 0, timeB: this.inputAudio[0].data.duration})}>reset\n     </button>\n     </Tooltip>\n     </span>\n     </center>\n\n     <div className='text-divider'>{m.playerTitle}</div>\n     <center>\n    <Tooltip title={m.record}>\n    <IconButton \n     onClick={()=> this.setState({micOn: !this.state.micOn})} >\n    <MicIcon color={this.state.micOn ? 'secondary' : 'primary'} />\n    </IconButton>\n    </Tooltip>\n    <PlayButton \n      nextAction={this.state.playButtonNextAction}\n      handler={this.handlePlay}\n      messages={m}\n   />\n     <Tooltip title={m.stopButton}>\n     <IconButton  \n       onClick={() => this.handlePlay({target: {name: 'stop'}})} >\n       <StopOutlinedIcon \n     color={this.inputAudio.length ? 'primary' : 'disabled'} />\n     </IconButton>\n     </Tooltip>\n     <Tooltip title={m.loopButton}>\n     <IconButton  \n       onClick={() => {this.setState({loop: !this.state.loop});}} >\n       <LoopOutlinedIcon \n       color={this.state.loop ? 'secondary' : 'primary'} />\n     </IconButton>\n     </Tooltip>\n\n     <Tooltip title={m.exportButton} aria-label='exportFile'>\n     <IconButton  \n       onClick={() => this.handlePlay({target: {name: 'exportFile'}})} >\n       <GetAppIcon \n       color={!this.inputAudio.length || this.state.isPlaying ? 'disabled' : 'primary'} />\n     </IconButton>\n     </Tooltip>\n\n     <Tooltip title={m.playMixButton} aria-label='playMix'>\n     <IconButton  \n       onClick={() => this.handlePlay({target: {name: 'playMix'}})} >\n       <PlayCircleFilledWhiteIcon\n       color={!this.inputAudio.length || this.state.isPlaying ? 'disabled' : 'primary'} />\n     </IconButton>\n     </Tooltip>\n     <Tooltip title={m.bypassButton}>\n     <IconButton\n       onClick={() => this.setState({bypass: !this.state.bypass})}>\n       <NotInterestedIcon\n       color={this.state.bypass ? 'disabled' : 'primary'} />\n    </IconButton>\n     </Tooltip>\n\n     </center>\n\n    {this.state.bypass ?  '' : \n    <SpeedPitchControls \n      playSpeed={this.state.playSpeed}\n      playPitch={this.state.playPitch}\n      setSpeed={this.setSpeed}\n      setPitch={this.setPitch}\n      messages={m}\n    />\n    }\n\n     <div className='slider' key='master'>\n       <div className='text-divider'>{m.masterGainTitle}&nbsp;\n       ({this.state.masterGain})</div>\n       <center>\n       0 <input type='range' id='master' name='gainSlider' \n          min='0' max='150' value={this.state.masterGain} \n           onChange={this.handleGainSlider} /> 150\n       </center>\n     </div>\n     <div className='text-divider'>{m.trackGainTitle}</div>\n     <TrackGainSliderList\n        inputAudio={this.inputAudio} \n        gains={this.state.gains}\n        handler={this.handleGainSlider}\n     />\n     <hr />\n     {m.version}: {version} &nbsp;&nbsp;\n     <a href={m.url}\n     target='_blank' rel='noreferrer'>{m.guide}</a><br />\n     {m.credit}&nbsp; \n     <a href=\"https://github.com/cutterbl/SoundTouchJS\"\n     target='_blank' rel='noreferrer'>SoundTouchJs</a><br />\n     <hr />\n     </div>\n    );\n  }\n\n  async loadFiles(event){\n\n    if (event.target.name !== 'loadFiles') return;\n    if (event.target.files.length === 0) return;\n    const files = event.target.files; \n\n    console.log('loadFiles');\n    if (this.audioCtx === null) {\n      console.log('AudioContext');\n      try {\n        this.audioCtx = new AudioContext();\n        await this.loadModule(this.audioCtx,'worklet/bundle.js');\n        console.log('AudioContext worklet module loaded');\n      } catch (error) {\n        console.log(error);\n      }\n    }\n\n    for (let i=0; i < files.length; i++){\n      const reader = new FileReader();\n\n      reader.onload = function (e){\n       this.audioCtx.decodeAudioData(reader.result,\n         function (audioBuffer) {\n           if (audioBuffer.numberOfChannels !== 2) {\n             alert ('Sorry, only stereo files are supported');\n             return;\n           }\n           this.inputAudio.push({\n              name: files[i].name,\n              data: audioBuffer,\n              source: null,\n              gainNode: null,\n              gain: 100,\n           });\n      \n           const gains = this.state.gains; gains.push(100);\n\n           this.setState({\n             playButtonNextAction: 'Play',\n               timeA: 0,\n               playingAt: 0,\n               timeB: this.inputAudio[0].data.duration, \n               gains: gains,\n           });\n\n     // this.inputAudio.sort((a,b) => a.name - b.name); // mmm.. does not work\n\n         }.bind(this),\n\n         function (error) { console.log (\"decode error: \" + error.err) }\n       )\n\n      }.bind(this)\n\n      reader.onerror = function (e){ console.log(\"File read \", reader.error);}\n      reader.readAsArrayBuffer(files[i]);\n\n    } // end for\n\n  } // end loadFiles()\n\n  handleTimeSlider(event){\n\n    if(event.target.name !== 'timeSlider') return;\n\n    if (!this.state.isPlaying)\n      this.setState({playingAt: parseFloat(event.target.value)});\n  }\n\n  handlePlay(event){\n\n    console.log('handlePlay name/button', \n       event.target.name, this.state.playButtonNextAction);\n\n    if (this.inputAudio.length === 0) alert(m.alert);\n\n    if (event.target.name === 'startPause') {\n\n      switch(this.state.playButtonNextAction){\n\n        case 'Pause':\n          console.log('Pause');\n          if(this.audioCtx) this.audioCtx.suspend();\n          this.setState ({\n            playButtonNextAction: 'Resume',\n            isPlaying: false \n          });\n        break;\n\n        case 'Resume': \n          console.log('Resume');\n          if (this.audioCtx.state === 'suspended') this.audioCtx.resume();\n          this.setState ({\n            playButtonNextAction: 'Pause', \n            isPlaying: true\n          });\n        break;\n\n        case 'Play':\n          console.log('Play');\n          if (this.inputAudio.length === 0) break;\n           this.playAB (0, this.state.timeA, this.state.timeB);\n\n          this.setState ({playButtonNextAction: 'Pause'})\n        break;\n\n        default:\n          console.log('default', this.state.playButtonNextAction);\n      }\n\n      return;\n    }\n\n    if (event.target.name === 'stop') {\n      if (this.shifter) this.shifter.stop();\n      if (this.mixedSource) this.mixedSource.stop();\n\n      this.setState ({loop: false, playButtonNextAction: 'Play', \n          playingAt: this.state.timeA})\n\n      return;\n    }    \n\n    if (event.target.name === 'exportFile' \n       || event.target.name === 'playMix'){\n\n      if (this.inputAudio.length === 0 || this.state.isPlaying) return;\n\n      const recording = true;\n      let offline = isOfflineAudioContext;\n      // if (iOS) { offline = false; }\n      this.playAB (0, this.state.timeA, this.state.timeB, \n          recording, offline, event.target.name);\n\n      return;\n    }\n\n  } // end handlePlay()\n\n  handleGainSlider(event){\n    if (event.target.name !== 'gainSlider') return;\n//       console.log ('slider id= ', event.target.id);\n// \n    if (event.target.id === 'master'){\n      this.setState({masterGain: parseFloat(event.target.value)});\n      if (this.masterGainNode)\n        this.masterGainNode.gain.value = parseFloat(event.target.value/100.0);\n      return;\n    }\n\n    const index = parseInt(event.target.id);\n\n    const gains = this.state.gains;\n    gains[index] = parseInt(event.target.value);\n    this.setState({gains: gains});\n    if (this.inputAudio[index].gainNode !== null)\n      this.inputAudio[index].gainNode.gain.value \n           = parseFloat(event.target.value/100.0); \n\n  } // End handleGainSlider()\n\n  setSpeed(e){\n    let speed = this.state.playSpeed;\n    switch(e.target.name){\n      case 'sub10': speed -=0.1; break;\n      case 'add10': speed +=0.1; break;\n      case 'sub1': speed -=0.01; break;\n      case 'add1': speed +=0.01; break;\n      default:\n    }\n    if (speed < 0.5) speed = 0.5;\n    else if (speed > 2.0) speed = 2.0;\n\n    if (this.shifter) this.shifter.tempo = speed;\n\n    this.setState({playSpeed: speed});\n  } // End set speed\n\n  setPitch(e){\n    let pitch = this.state.playPitch;\n    switch(e.target.name){\n      case 'sub1': pitch -=1; break;\n      case 'add1': pitch +=1; break;\n      case 'sub10c': pitch -=0.1; break;\n      case 'add10c': pitch +=0.1; break;\n      default:\n    }\n\n    if (pitch < -12) pitch = -12.0;\n    else if (pitch > 12) pitch = 12.0\n\n    if (this.shifter) this.shifter.pitch = Math.pow(2.0,pitch/12.0);\n\n    this.setState({playPitch: pitch});\n\n  } // End setPitch\n\n  switchLanguage(e) {\n\n    if (this.state.language === 'ja') {\n      m = messages.en; \n      this.setState({language: 'en'});\n    } else {\n      m = messages.ja; \n      this.setState({language: 'ja'});\n    }\n  } // End switchLanguage()\n\n  async playAB(delay, timeA, timeB, recording = false, \n       offline = false, exporter='none'){\n\n    console.log('playAB', \n       'delay, timeA, timeB, recording, offline, exporter = ', \n       delay, timeA, timeB, recording, offline, exporter);\n\n    if (this.state.isPlaying) return;\n    if (this.audioCtx.state === 'suspended' ) this.audioCtx.resume();\n\n    const sampleRate = this.inputAudio[0].data.sampleRate;\n    const channels = this.inputAudio[0].data.numberOfChannels;\n    const nInputFrames = (timeB - timeA)*sampleRate;\n    const nOutputFrames = Math.max(nInputFrames, \n                      nInputFrames/this.state.playSpeed);\n\n    let context = null;\n    if (offline){\n      context = new OfflineAudioContext (\n        channels,\n        nOutputFrames*1.1, // add 10%\n        sampleRate \n      );\n      await this.loadModule (context, 'worklet/bundle.js');\n      console.log('OfflineAudioContext Worklet module loaded');\n      if (OfflineAudioContext.suspend) context.suspend();\n    } else context = this.audioCtx;\n\n    this.setState({isPlaying : true});\n\n    let updateInterval = 1.0;\n    if (offline) updateInterval = 10.0;\n\n    const options = { // For worklet \n      processorOptions: {\n        bypass: this.state.bypass,\n        recording: false, // recording is done in OfflineAudioContext\n        nInputFrames: nInputFrames, \n        updateInterval: updateInterval, \n        sampleRate: sampleRate\n      },\n    };\n\n    let shifter = null;\n    if (!this.state.useAudioWorklet) { \n        // Offline worklet not working perfectly yet\n      shifter = new MyPitchShifter( context, nInputFrames, \n        // 4096, recording, this.state.bypass); // ScriptProcessorNode\n        4096, recording, this.state.bypass); // ScriptProcessorNode\n      shifter.updateInterval = updateInterval;\n    } else { // load the same worklet for OfflineAudioContext\n      try {\n        shifter = new MyPitchShifterWorkletNode( context, \n          'my-soundtouch-processor', options); // ScriptProcessorNode\n        shifter.updateInterval = updateInterval;\n        console.log('AudioWorkletNode functional');\n      } catch (err) { \n        console.log(err);\n        shifter = null;\n        shifter = new MyPitchShifter( context, nInputFrames, \n          4096, recording, this.state.bypass); // ScriptProcessorNode\n        shifter.updateInterval = updateInterval;\n        console.log('Worklet failed. Fallback to ScriptProcessorNode');\n        // Creation of shifter does not work for Online (reason unknown)\n\n      }\n    } // end if useAudioWorklet \n\n    if (!offline) this.shifter = shifter;\n\n    shifter.tempo = this.state.playSpeed;\n    shifter.pitch = Math.pow(2.0,this.state.playPitch/12.0);\n\n/*\n    const dummySourceNode = context.createOscillator();\n    const zeroGain = context.createGain(); zeroGain.gain.value = 0.2;\n    dummySourceNode.connect(zeroGain); zeroGain.connect(shifter); \n*/\n\n    for (let i=0; i < this.inputAudio.length; i++){\n\n      const source = context.createBufferSource();\n       if (i === 0)\n         source.buffer = this.addZeros(context,this.inputAudio[i].data);\n       else \n        source.buffer = this.inputAudio[i].data;\n        this.inputAudio[i].source = source;\n      const gainNode = context.createGain();\n        gainNode.gain.value = this.state.gains[i]/100.0;\n        this.inputAudio[i].gainNode = gainNode;\n      source.connect(gainNode);\n      gainNode.connect(shifter.node);\n    }\n\n  if (!offline) {\n    const masterGainNode = context.createGain();\n    masterGainNode.gain.value = this.state.masterGain/100.0;\n    this.masterGainNode = masterGainNode;\n    shifter.node.connect(masterGainNode);\n    masterGainNode.connect(context.destination);\n  } else shifter.node.connect(context.destination);\n\n\n    const begin = context.currentTime + delay;\n    for (let i=0; i < this.inputAudio.length; i++)\n      this.inputAudio[i].source.start(begin, timeA);\n\n    // dummySourceNode.start(begin, timeA);\n\n    if (offline) {\n      console.log('startRendering');\n      context.startRendering();\n    }\n\n    this.inputAudio[0].source.onended = function(e) {\n      console.log('source 0 onended At', this.state.playingAt);\n    }.bind(this);\n\n    shifter.onUpdate = function(val) { \n      this.setState({playingAt: timeA + val});\n    }.bind(this);\n\n    if (offline) {\n      context.oncomplete = function(e) {\n        console.log( \n         'Offline render complete (data is useless though) length = ',\n          e.renderedBuffer.length);\n\n        if (this.state.useAudioWorklet){\n          if (exporter === 'exportFile') {\n            console.log('exportFile in oncomlete'); \n            shifter.exportToFile('mix_' + Date.now() + '.wav', \n           e.renderedBuffer);\n          } else if (exporter === 'playMix') {\n            console.log('playMix in oncomlete'); \n            this.playSource(e.renderedBuffer);\n          } else console.log('exporter unknown: ', exporter);\n         }\n      }.bind(this);\n    }\n\n    shifter.onEnd = function(recordedBuffer) { \n       // recordedBuffer made in shifter from worklet's message data\n      console.log('shifter onEnd');\n\n      for (let i=0; i < this.inputAudio.length; i++)\n        this.inputAudio[i].gainNode.disconnect();\n\n      this.setState({isPlaying: false});\n\n      if (!this.state.useAudioWorklet) {\n        if (exporter === 'exportFile' ) {\n         shifter.exportToFile('mix_' + Date.now() + '.wav');\n          this.setState({isPlaying: false}); // audioBuffer is in the shifter\n        } else if (exporter === 'playMix')\n          this.playSource(recordedBuffer);\n      }\n\n   }.bind(this);\n\n  } // END playAB\n\n  async loadModule (\n    context,filename,moduleName,workletOptions) {\n      if (!context) return false;\n      let name = context.constructor.name;\n\n      try {\n        await context.audioWorklet.addModule(filename);\n        //console.log(name, 'AudioWorklet loaded');\n      } catch(e) {\n        console.log(e, name, 'AudioWorklet load failed');\n        return null\n      }\n\n    return true;\n  }\n\n  addZeros(context,input){ // return zero padded double length AudioBuffer\n    console.log('addZeros');\n    const output = context.createBuffer(\n      input.numberOfChannels, \n      input.length*2*1.05, // extra 5%\n      input.sampleRate\n    ); // additional 5 sec\n\n    for (let ch = 0; ch < output.numberOfChannels; ch++){\n      const inSamples = input.getChannelData(ch);\n      const outSamples = output.getChannelData(ch);\n      outSamples.set(inSamples);\n    }\n\n    return output;\n  } // End addZeros()\n\n\n  playSource(audioBuffer){ \n     if (audioBuffer === null) {console.log('audioBuffer null'); return;}\n\n     const context = this.audioCtx;\n     this.setState({isPlaying: true, playButtonNextAction: 'Pause'});\n     const source = context.createBufferSource();\n     this.mixedSource = source;\n     source.buffer = audioBuffer;\n     const masterGainNode = context.createGain();\n       this.masterGainNode = masterGainNode;\n       masterGainNode.gain.value = this.state.masterGain/100;\n     source.connect(this.masterGainNode);\n       masterGainNode.connect(context.destination);\n     source.start();\n\n     source.onended = function(e) {\n       this.mixedSource = null;\n       this.setState({isPlaying: false});\n     }.bind(this);\n  }\n\n}; // end class\n\nexport default App;\n","/*\n   Written by goto at kmgoto.jp (Mar. 2021)\n   Copyright of my code is not claimed.\n\n   Based on soundtouchjs/src/PitchShifter.js, SimpleFilter.js\n\n   Modified for use as intermediate ScriptProcessorNode.\n   Note: Output does not work for OfflineAudioContext.\n\n   1) PitchShifter ---> MyPitchShifter (minimum code)\n                     includes ScriptProcessorNode\n       or --> MyPitchShifternode (AudioWorkletNode)\n\n   2) MyFilter extends SimpleFilter\n\n   Pitch modification and slow down/speed up work.\n   Slow down only for real-time playback.\n   Fast real-time playback is impossible by nature.\n\n   3) AudioWorklet is in public/worklet/ \n      (public is the document root.)\n\n */\n\nimport { Component }  from 'react';\nimport './App.css';\nimport MyPitchShifter from './jslibs/MyPitchShifter'; // soundtouchJS\n// import MyPitchShifterWorkletNode from './jslibs/MyPitchShifterWorkletNode';\n// UI Components\nimport PlayButton from './jslibs/PlayButton';\nimport SpeedPitchControls from './jslibs/SpeedPitchControls';\nimport TrackGainSliderList from './jslibs/TrackGainSliderList';\n\nimport packageJSON from '../package.json';\nimport messages from './messages.json'; // English/Japanese messages\n\n// material-ui Icons, Tooltip\nimport { IconButton, Tooltip } from '@material-ui/core';\nimport StopOutlinedIcon from '@material-ui/icons/StopOutlined';\nimport LoopOutlinedIcon from '@material-ui/icons/LoopOutlined';\nimport GetAppIcon from '@material-ui/icons/GetApp';\nimport PlayCircleFilledWhiteIcon \n   from '@material-ui/icons/PlayCircleFilledWhite';\nimport NotInterestedIcon from '@material-ui/icons/NotInterested';\nimport MoodIcon from '@material-ui/icons/Mood';\nimport MicIcon from '@material-ui/icons/Mic';\n// import { AudioContext, OfflineAudioContext }  from 'standardized-audio-context';\n\n// get subversion string \nconst version = packageJSON.subversion;\n\n// alert(navigator.userAgent);\n\n// switch languages\nlet defaultLang = 'en';\nlet m = messages.en;\nconsole.log(window.navigator.language);\nif (window.navigator.language.slice(0,2) === 'ja') {\n  defaultLang = 'ja'; \n  m = messages.ja;\n}\n\n/*\nlet iOS = false;\nif(  navigator.userAgent.match(/iPhone/i) \n  || navigator.userAgent.match(/iPod/i)\n  || navigator.userAgent.match(/iPad/i)){\n  iOS = true;\n}\n*/\n\n// AudioWorklet check with OfflineAudioContext (from Google Labs example)\nlet tmp = false;\nif (OfflineAudioContext) {\n  tmp = true; \n  console.log('OfflineAudioContext available');\n } else tmp = false;\nconst isOfflineAudioContext = tmp;\n\nlet isAudioWorkletNode = false;\nlet isAudioWorklet = false;\n\nconst isAudioWorkletAvailable = (isAudioWorkletNode & isAudioWorklet);\n\nclass AppNoWorklet extends Component {\n\n  constructor (props) {\n    super();\n    this.audioCtx = null;\n    this.inputAudio = [];\n    this.mixedSource = null;\n    this.masterGainNode = null;\n \n    this.state = {\n      language: defaultLang,\n      isPlaying: false,\n      timeA: 0,\n      playingAt: 0,\n      timeB: 0, \n      loop: false,\n      loopDelay: 2,\n      playButtonNextAction: 'load files first!',\n      gains: [],\n      masterGain: 75,\n      playSpeed: 1.0,\n      playPitch: 0.0,\n      bypass: false,\n      useAudioWorklet: isAudioWorkletAvailable,\n      micOn: false,\n    };\n\n    this.shifter = null;\n\n    this.loadFiles = this.loadFiles.bind(this);\n    this.handlePlay = this.handlePlay.bind(this);\n    this.handleGainSlider = this.handleGainSlider.bind(this);\n    this.handleTimeSlider = this.handleTimeSlider.bind(this);\n    this.playAB = this.playAB.bind(this);\n    this.setSpeed = this.setSpeed.bind(this);\n    this.setPitch = this.setPitch.bind(this);\n    this.switchLanguage = this.switchLanguage.bind(this);\n  }   \n\n  componentWillUnmount () { // before closing app\n    if (this.audioCtx !== null) this.audioCtx.close();\n  }\n\n\n  render(){\n\n    return (\n     <div className=\"App\">\n     {m.title}\n     <br />\n     <center>\n     (language) &ensp;\n     <span className='tiny-button'>\n     <Tooltip title={m.switchLang}>\n      <button onClick = {this.switchLanguage}>\n      {this.state.language === 'ja' ? 'EN' : 'JP' }</button>\n     </Tooltip>\n     </span>\n     &ensp;(AudioWorklet)\n     <Tooltip title={m.worklet}>\n     <IconButton name='toggleWorklet'\n     onClick = {\n       () => {\n        if (isAudioWorkletNode)\n        this.setState({useAudioWorklet: !this.state.useAudioWorklet});}\n     } >\n     <MoodIcon color={this.state.useAudioWorklet? 'primary':'disabled'} />\n     </IconButton>\n     </Tooltip>\n     </center>\n     <hr />\n     <span className=\"selectFile\">\n     <Tooltip title={m.fileReader}>\n     <input type=\"file\" name=\"loadFiles\" multiple\n        accept=\"audio/*\" onChange={this.loadFiles} />\n     </Tooltip>\n     &emsp;<span className='tiny-button'>\n     <Tooltip title={m.clearFiles}>\n     <button name='clearFile' onClick = {() => {\n       this.setState({gains: [], \n       playButtonNextAction: 'load files first!'});\n       this.inputAudio = []; }} \n     >{m.clearButton}</button></Tooltip></span>\n     <br />\n     </span><br/>\n     <div className='text-divider'>{m.timeTitle}&nbsp;\n      ({m.timeSliderPosition}:&nbsp; \n       <font color='green'>{this.state.playingAt.toFixed(2)}</font>)\n     </div>\n     <center>\n     A: {this.state.timeA.toFixed(2)} -- B: {this.state.timeB.toFixed(2)}\n     &emsp; song length: {this.inputAudio[0] ? \n          this.inputAudio[0].data.duration.toFixed(2) : 0.00}\n     <br />\n     <div className='slider'>\n     <Tooltip title={m.timeSlider}>\n     <input type='range' name='timeSlider'\n       min='0' max= {this.inputAudio[0] ? \n              this.inputAudio[0].data.duration : 0}\n       value={this.state.playingAt}\n       onChange={this.handleTimeSlider}\n     />\n     </Tooltip>\n     </div>\n     <span className='tiny-button'>\n     <Tooltip title={m.setA}>\n     <button name='setA' \n        onClick={()=> this.setState({timeA: this.state.playingAt})}>\n        set A\n     </button>\n     </Tooltip>\n      &emsp;\n     <Tooltip title={m.setB}>\n     <button name='setB' \n        onClick={()=> this.setState({timeB: this.state.playingAt})}>\n        set B\n     </button>\n     </Tooltip>\n      &emsp;\n     <Tooltip title={m.resetAB}>\n     <button name='reset' \n        onClick={()=> this.setState({timeA: 0, timeB: this.inputAudio[0].data.duration})}>reset\n     </button>\n     </Tooltip>\n     </span>\n     </center>\n\n     <div className='text-divider'>{m.playerTitle}</div>\n     <center>\n    <Tooltip title={m.record}>\n    <IconButton \n     onClick={()=> this.setState({micOn: !this.state.micOn})} >\n    <MicIcon color={this.state.micOn ? 'secondary' : 'primary'} />\n    </IconButton>\n    </Tooltip>\n    <PlayButton \n      nextAction={this.state.playButtonNextAction}\n      handler={this.handlePlay}\n      messages={m}\n   />\n     <Tooltip title={m.stopButton}>\n     <IconButton  \n       onClick={() => this.handlePlay({target: {name: 'stop'}})} >\n       <StopOutlinedIcon \n     color={this.inputAudio.length ? 'primary' : 'disabled'} />\n     </IconButton>\n     </Tooltip>\n     <Tooltip title={m.loopButton}>\n     <IconButton  \n       onClick={() => {this.setState({loop: !this.state.loop});}} >\n       <LoopOutlinedIcon \n       color={this.state.loop ? 'secondary' : 'primary'} />\n     </IconButton>\n     </Tooltip>\n\n     <Tooltip title={m.exportButton} aria-label='exportFile'>\n     <IconButton  \n       onClick={() => this.handlePlay({target: {name: 'exportFile'}})} >\n       <GetAppIcon \n       color={!this.inputAudio.length || this.state.isPlaying ? 'disabled' : 'primary'} />\n     </IconButton>\n     </Tooltip>\n\n     <Tooltip title={m.playMixButton} aria-label='playMix'>\n     <IconButton  \n       onClick={() => this.handlePlay({target: {name: 'playMix'}})} >\n       <PlayCircleFilledWhiteIcon\n       color={!this.inputAudio.length || this.state.isPlaying ? 'disabled' : 'primary'} />\n     </IconButton>\n     </Tooltip>\n     <Tooltip title={m.bypassButton}>\n     <IconButton\n       onClick={() => this.setState({bypass: !this.state.bypass})}>\n       <NotInterestedIcon\n       color={this.state.bypass ? 'disabled' : 'primary'} />\n    </IconButton>\n     </Tooltip>\n\n     </center>\n\n    {this.state.bypass ?  '' : \n    <SpeedPitchControls \n      playSpeed={this.state.playSpeed}\n      playPitch={this.state.playPitch}\n      setSpeed={this.setSpeed}\n      setPitch={this.setPitch}\n      messages={m}\n    />\n    }\n\n     <div className='slider' key='master'>\n       <div className='text-divider'>{m.masterGainTitle}&nbsp;\n       ({this.state.masterGain})</div>\n       <center>\n       0 <input type='range' id='master' name='gainSlider' \n          min='0' max='150' value={this.state.masterGain} \n           onChange={this.handleGainSlider} /> 150\n       </center>\n     </div>\n     <div className='text-divider'>{m.trackGainTitle}</div>\n     <TrackGainSliderList\n        inputAudio={this.inputAudio} \n        gains={this.state.gains}\n        handler={this.handleGainSlider}\n     />\n     <hr />\n     {m.version}: {version} &nbsp;&nbsp;\n     <a href={m.url}\n     target='_blank' rel='noreferrer'>{m.guide}</a><br />\n     {m.credit}&nbsp; \n     <a href=\"https://github.com/cutterbl/SoundTouchJS\"\n     target='_blank' rel='noreferrer'>SoundTouchJs</a><br />\n     <hr />\n     </div>\n    );\n  }\n\n  async loadFiles(event){\n\n    if (event.target.name !== 'loadFiles') return;\n    if (event.target.files.length === 0) return;\n    const files = event.target.files; \n\n    console.log('loadFiles');\n    if (this.audioCtx === null) {\n      console.log('AudioContext');\n      try {\n        this.audioCtx = new AudioContext();\n        await this.loadModule(this.audioCtx,'worklet/bundle.js');\n        console.log('AudioContext worklet module loaded');\n      } catch (error) {\n        console.log(error);\n      }\n    }\n\n    for (let i=0; i < files.length; i++){\n      const reader = new FileReader();\n\n      reader.onload = function (e){\n       this.audioCtx.decodeAudioData(reader.result,\n         function (audioBuffer) {\n           if (audioBuffer.numberOfChannels !== 2) {\n             alert ('Sorry, only stereo files are supported');\n             return;\n           }\n           this.inputAudio.push({\n              name: files[i].name,\n              data: audioBuffer,\n              source: null,\n              gainNode: null,\n              gain: 100,\n           });\n      \n           const gains = this.state.gains; gains.push(100);\n\n           this.setState({\n             playButtonNextAction: 'Play',\n               timeA: 0,\n               playingAt: 0,\n               timeB: this.inputAudio[0].data.duration, \n               gains: gains,\n           });\n\n     // this.inputAudio.sort((a,b) => a.name - b.name); // mmm.. does not work\n\n         }.bind(this),\n\n         function (error) { console.log (\"decode error: \" + error.err) }\n       )\n\n      }.bind(this)\n\n      reader.onerror = function (e){ console.log(\"File read \", reader.error);}\n      reader.readAsArrayBuffer(files[i]);\n\n    } // end for\n\n  } // end loadFiles()\n\n  handleTimeSlider(event){\n\n    if(event.target.name !== 'timeSlider') return;\n\n    if (!this.state.isPlaying)\n      this.setState({playingAt: parseFloat(event.target.value)});\n  }\n\n  handlePlay(event){\n\n    console.log('handlePlay name/button', \n       event.target.name, this.state.playButtonNextAction);\n\n    if (this.inputAudio.length === 0) alert(m.alert);\n\n    if (event.target.name === 'startPause') {\n\n      switch(this.state.playButtonNextAction){\n\n        case 'Pause':\n          console.log('Pause');\n          if(this.audioCtx) this.audioCtx.suspend();\n          this.setState ({\n            playButtonNextAction: 'Resume',\n            isPlaying: false \n          });\n        break;\n\n        case 'Resume': \n          console.log('Resume');\n          if (this.audioCtx.state === 'suspended') this.audioCtx.resume();\n          this.setState ({\n            playButtonNextAction: 'Pause', \n            isPlaying: true\n          });\n        break;\n\n        case 'Play':\n          console.log('Play');\n          if (this.inputAudio.length === 0) break;\n           this.playAB (0, this.state.timeA, this.state.timeB);\n\n          this.setState ({playButtonNextAction: 'Pause'})\n        break;\n\n        default:\n          console.log('default', this.state.playButtonNextAction);\n      }\n\n      return;\n    }\n\n    if (event.target.name === 'stop') {\n      if (this.shifter) this.shifter.stop();\n      if (this.mixedSource) this.mixedSource.stop();\n\n      this.setState ({loop: false, playButtonNextAction: 'Play', \n          playingAt: this.state.timeA})\n\n      return;\n    }    \n\n    if (event.target.name === 'exportFile' \n       || event.target.name === 'playMix'){\n\n      if (this.inputAudio.length === 0 || this.state.isPlaying) return;\n\n      const recording = true;\n      let offline = isOfflineAudioContext;\n      // if (iOS) { offline = false; }\n      this.playAB (0, this.state.timeA, this.state.timeB, \n          recording, offline, event.target.name);\n\n      return;\n    }\n\n  } // end handlePlay()\n\n  handleGainSlider(event){\n    if (event.target.name !== 'gainSlider') return;\n//       console.log ('slider id= ', event.target.id);\n// \n    if (event.target.id === 'master'){\n      this.setState({masterGain: parseFloat(event.target.value)});\n      if (this.masterGainNode)\n        this.masterGainNode.gain.value = parseFloat(event.target.value/100.0);\n      return;\n    }\n\n    const index = parseInt(event.target.id);\n\n    const gains = this.state.gains;\n    gains[index] = parseInt(event.target.value);\n    this.setState({gains: gains});\n    if (this.inputAudio[index].gainNode !== null)\n      this.inputAudio[index].gainNode.gain.value \n           = parseFloat(event.target.value/100.0); \n\n  } // End handleGainSlider()\n\n  setSpeed(e){\n    let speed = this.state.playSpeed;\n    switch(e.target.name){\n      case 'sub10': speed -=0.1; break;\n      case 'add10': speed +=0.1; break;\n      case 'sub1': speed -=0.01; break;\n      case 'add1': speed +=0.01; break;\n      default:\n    }\n    if (speed < 0.5) speed = 0.5;\n    else if (speed > 2.0) speed = 2.0;\n\n    if (this.shifter) this.shifter.tempo = speed;\n\n    this.setState({playSpeed: speed});\n  } // End set speed\n\n  setPitch(e){\n    let pitch = this.state.playPitch;\n    switch(e.target.name){\n      case 'sub1': pitch -=1; break;\n      case 'add1': pitch +=1; break;\n      case 'sub10c': pitch -=0.1; break;\n      case 'add10c': pitch +=0.1; break;\n      default:\n    }\n\n    if (pitch < -12) pitch = -12.0;\n    else if (pitch > 12) pitch = 12.0\n\n    if (this.shifter) this.shifter.pitch = Math.pow(2.0,pitch/12.0);\n\n    this.setState({playPitch: pitch});\n\n  } // End setPitch\n\n  switchLanguage(e) {\n\n    if (this.state.language === 'ja') {\n      m = messages.en; \n      this.setState({language: 'en'});\n    } else {\n      m = messages.ja; \n      this.setState({language: 'ja'});\n    }\n  } // End switchLanguage()\n\n  async playAB(delay, timeA, timeB, recording = false, \n       offline = false, exporter='none'){\n\n    console.log('playAB', \n       'delay, timeA, timeB, recording, offline, exporter = ', \n       delay, timeA, timeB, recording, offline, exporter);\n\n    if (this.state.isPlaying) return;\n    if (this.audioCtx.state === 'suspended' ) this.audioCtx.resume();\n\n    const sampleRate = this.inputAudio[0].data.sampleRate;\n    const channels = this.inputAudio[0].data.numberOfChannels;\n    const nInputFrames = (timeB - timeA)*sampleRate;\n    const nOutputFrames = Math.max(nInputFrames, \n                      nInputFrames/this.state.playSpeed);\n\n    let context = null;\n    if (offline){\n      context = new OfflineAudioContext (\n        channels,\n        nOutputFrames*1.1, // add 10%\n        sampleRate \n      );\n      // await this.loadModule (context, 'worklet/bundle.js');\n      console.log('OfflineAudioContext Worklet module loaded');\n      if (OfflineAudioContext.suspend) context.suspend();\n    } else context = this.audioCtx;\n\n    this.setState({isPlaying : true});\n\n    let updateInterval = 1.0;\n    if (offline) updateInterval = 10.0;\n\n/*\n    const options = {\n      processorOptions: {\n        bypass: this.state.bypass,\n        recording: recording,\n        nInputFrames: nInputFrames, \n        updateInterval: updateInterval, \n        sampleRate: sampleRate\n      },\n    };\n*/\n\n    let shifter = null;\n    // if (!this.state.useAudioWorklet || offline) { \n    if (!this.state.useAudioWorklet) { \n        // Offline worklet not working perfectly yet\n      shifter = new MyPitchShifter( context, nInputFrames, \n        4096, recording, this.state.bypass); // ScriptProcessorNode\n      shifter.updateInterval = updateInterval;\n    } else { // load the same worklet for OfflineAudioContext\n      try {\n        /*\n         shifter = new MyPitchShifterWorkletNode( context, \n          'my-soundtouch-processor', options); // ScriptProcessorNode\n        shifter.updateInterval = updateInterval;\n        console.log('AudioWorkletNode functional');\n        */\n      } catch (err) { \n        console.log(err);\n        shifter = null;\n        shifter = new MyPitchShifter( context, nInputFrames, \n          4096, recording, this.state.bypass); // ScriptProcessorNode\n        shifter.updateInterval = updateInterval;\n        console.log('Worklet failed. Fallback to ScriptProcessorNode');\n        // Creation of shifter does not work for Online (reason unknown)\n\n      }\n    } // end if useAudioWorklet \n\n    if (!offline) this.shifter = shifter;\n\n    shifter.tempo = this.state.playSpeed;\n    shifter.pitch = Math.pow(2.0,this.state.playPitch/12.0);\n\n/*\n    const dummySourceNode = context.createOscillator();\n    const zeroGain = context.createGain(); zeroGain.gain.value = 0.2;\n    dummySourceNode.connect(zeroGain); zeroGain.connect(shifter); \n*/\n\n    for (let i=0; i < this.inputAudio.length; i++){\n\n      const source = context.createBufferSource();\n       if (i === 0)\n         source.buffer = this.addZeros(context,this.inputAudio[i].data);\n       else \n        source.buffer = this.inputAudio[i].data;\n        this.inputAudio[i].source = source;\n      const gainNode = context.createGain();\n        gainNode.gain.value = this.state.gains[i]/100.0;\n        this.inputAudio[i].gainNode = gainNode;\n      source.connect(gainNode);\n      gainNode.connect(shifter.node);\n    }\n\n  if (!offline) {\n    const masterGainNode = context.createGain();\n    masterGainNode.gain.value = this.state.masterGain/100.0;\n    this.masterGainNode = masterGainNode;\n    shifter.node.connect(masterGainNode);\n    masterGainNode.connect(context.destination);\n  } else shifter.node.connect(context.destination);\n\n\n    const begin = context.currentTime + delay;\n    for (let i=0; i < this.inputAudio.length; i++)\n      this.inputAudio[i].source.start(begin, timeA);\n\n    // dummySourceNode.start(begin, timeA);\n\n    if (offline) {\n      console.log('startRendering');\n      context.startRendering();\n    }\n\n/*\n    this.inputAudio[0].source.onended = function(e) {\n      console.log('source 0 onended At', this.state.playingAt);\n    }.bind(this);\n*/\n\n    shifter.onUpdate = function(val) { \n      this.setState({playingAt: timeA + val});\n    }.bind(this);\n\n    if (offline) {\n      context.oncomplete = function(e) {\n        console.log( \n         'Offline render complete (data is useless though) length = ',\n          e.renderedBuffer.length);\n        // shifter.stop();\n      }\n    }\n\n    shifter.onEnd = function(recordedBuffer) { \n       // recordedBuffer made in shifter from worklet's message data\n      console.log('shifter onEnd');\n\n      for (let i=0; i < this.inputAudio.length; i++)\n        this.inputAudio[i].gainNode.disconnect();\n\n      this.setState({isPlaying: false});\n\n      if (exporter === 'exportFile' ) {\n        console.log('exportFile', recordedBuffer.length);\n        shifter.exportToFile('mix_' + Date.now() + '.wav');\n        this.setState({isPlaying: false}); // audioBuffer is in the shifter\n      } else if (exporter === 'playMix'){\n        console.log('playMix', recordedBuffer.length);\n        const context = this.audioCtx;\n        this.setState({isPlaying: true, playButtonNextAction: 'Pause'});\n        const source = context.createBufferSource();\n          this.mixedSource = source;\n          source.buffer = recordedBuffer;\n         const masterGainNode = context.createGain();\n           this.masterGainNode = masterGainNode;\n           masterGainNode.gain.value = this.state.masterGain/100;\n         source.connect(this.masterGainNode);\n         masterGainNode.connect(context.destination);\n         source.start();\n\n         source.onended = function(e) {\n           this.mixedSource = null;\n           this.setState({isPlaying: false});\n         }.bind(this);\n\n      }\n\n   }.bind(this);\n\n  } // END playAB\n\n/*\n  async loadModule (\n    context,filename,moduleName,workletOptions) {\n      if (!context) return false;\n      let name = context.constructor.name;\n\n      try {\n        await context.audioWorklet.addModule(filename);\n        //console.log(name, 'AudioWorklet loaded');\n      } catch(e) {\n        console.log(e, name, 'AudioWorklet load failed');\n        return null\n      }\n\n    return true;\n  }\n*/\n\n  addZeros(context,input){ // return zero padded double length AudioBuffer\n    console.log('addZeros');\n    const output = context.createBuffer(\n      input.numberOfChannels, \n      input.length*2*1.05, // extra 5%\n      input.sampleRate\n    ); // additional 5 sec\n\n    for (let ch = 0; ch < output.numberOfChannels; ch++){\n      const inSamples = input.getChannelData(ch);\n      const outSamples = output.getChannelData(ch);\n      outSamples.set(inSamples);\n    }\n\n    return output;\n  } // End addZeros()\n\n}; // end class\n\nexport default AppNoWorklet;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://cra.link/PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://cra.link/PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://cra.link/PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.');\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","const reportWebVitals = (onPerfEntry) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport AppNoWorklet from './AppNoWorklet';\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\nimport reportWebVitals from './reportWebVitals';\n\n/*\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n*/\n  ReactDOM.render(\n   <App />,\n  document.getElementById('root')\n  );\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://cra.link/PWA\n// serviceWorkerRegistration.unregister();\nserviceWorkerRegistration.register();\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}