<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
</head>
<body>
<h1>MediaStreamTrack settings and RTCRtpSender codecs</h1>

localVideo (audio muted)<br/>

<video id="localVideoAndAudio" autoplay controls muted></video>
<p id="deviceInfoStr"></p>
<p id="capabilities"></p>
<p id="userAgent"></p>

<script>

let localVideoAndAudio = document.getElementById("localVideoAndAudio");
let deviceInfoStr = document.getElementById("deviceInfoStr");
let capabilities = document.getElementById("capabilities");
let userAgent = document.getElementById("userAgent");
userAgent.innerHTML = "UserAgent: " + navigator.userAgent + '<hr/>';

if (RTCRtpSender.getCapabilities){ // static function
  let cap = RTCRtpSender.getCapabilities("video");
  capabilities.innerHTML = "Web RTC Video getCapabilities():<br/>" 
    + JSON.stringify(cap,null,'\t') + "<hr/>";

  cap = RTCRtpSender.getCapabilities("audio");
  capabilities.innerHTML += "Web RTC Audio getCapabilities():<br/>" 
  + JSON.stringify(cap,null,'\t') + "<hr/>";
} else {
  capabilities.innerHTML = "RTCRtpSender.getCapabilities() is NOT supported";
}

if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
    console.log("navigator.mediaDevices.enumerateDevices() not supported."); 
    // return;
}

let constraints =  {
     video: {frameRate: 1, width: 320, height: 240},
     audio: {autoGainControl: false, 
             echoCancellation: false, 
             noiseSuppression: false} 
    };

// constraints.audio = true;

navigator.mediaDevices.getUserMedia(constraints)
  .then (function(stream) {

    console.log("Success");
    deviceInfoStr.innerHTML = "getSettings() for each track:<br/>" 

    let tracks = stream.getVideoTracks()
    deviceInfoStr.innerHTML += "Video settings: " 
        + JSON.stringify(tracks[0].getSettings(),null,'\t') + "<hr/>";
    localVideoAndAudio.srcObject = stream;

    tracks = stream.getAudioTracks();
    tracks.forEach ( (track) => {
     deviceInfoStr.innerHTML += "Audio settings: " 
        + JSON.stringify(track.getSettings(),null,'\t') + "<hr/>";
     // track.applyConstraints(newConstraints);
     // console.log(track.getSettings());
    });

    let mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.start();

   })
   .catch(function(err) {
      console.log(err);
   });

</script>
